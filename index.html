<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Section Schema UI | Shopify</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="build.css">
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script async src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
</head>

<body class="relative antialiased">
  <main role="main">
    <div class="max-w-screen-xl px-4 py-12 mx-auto">
      <section>
        <div class="max-w-prose">
          <h1 class="text-3xl font-bold">
            Section Schema UI for Shopify
          </h1>

          <p class="mt-4">
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Eius omnis exercitationem minus obcaecati suscipit culpa earum ea consequuntur atque dolores, dolorem esse aspernatur, tenetur nesciunt vel optio quibusdam explicabo debitis!
          </p>
        </div>
      </section>

      <section
        x-data="schema"
        class="p-8 mt-8 border border-gray-100 bg-gray-50 rounded-3xl"
      >
        <form
          @submit.prevent="updateSection"
          class="flow-root"
        >
          <div class="-my-8 divide-y divide-gray-100">
            <fieldset class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div>
                <legend class="font-medium">
                  <span
                    role="img"
                    class="mr-1.5"
                  >
                    üìá
                  </span>

                  Details
                </legend>

                <p class="mt-1 text-sm max-w-[40ch]">
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Odio laudantium eaque quibusdam, obcaecati sint sunt.
                </p>
              </div>

              <div class="grid grid-cols-1 gap-4 lg:grid-cols-6 lg:col-span-2">
                <div class="lg:col-span-3">
                  <label for="details_name">Name</label>
                  <input type="text" id="details_name" x-model="$store.details.name" @input="updateSection">
                </div>

                <div class="lg:col-span-3">
                  <label for="details_class">Class</label>
                  <input type="text" id="details_class" x-model="$store.details.class" @input="updateSection">
                </div>

                <div class="lg:col-span-2">
                  <label for="details_tag">Tag</label>
                  <select id="details_tag" x-model="$store.details.tag" @change="updateSection">
                    <option value="div">div</option>
                    <option value="section">section</option>
                    <option value="header">header</option>
                    <option value="footer">footer</option>
                    <option value="article">article</option>
                    <option value="aside">aside</option>
                  </select>
                </div>

                <div class="lg:col-span-2">
                  <label for="details_max_blocks">Max Blocks</label>
                  <input type="number" id="details_max_blocks" x-model="$store.details.max_blocks" @input="updateSection">
                </div>
              </div>
            </fieldset>

            <fieldset class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div>
                <legend class="font-medium">
                  <span role="img" class="mr-1.5">
                    üêô
                  </span>

                  Settings
                </legend>

                <p class="max-w-[40ch] mt-1 text-sm">
                  Lorem, ipsum dolor sit amet consectetur adipisicing elit.
                  Non, quod beatae voluptates possimus recusandae dolor!
                </p>
              </div>

              <div class="grid grid-cols-1 gap-4 lg:grid-cols-6 lg:col-span-2">
                <template x-if="shouldShow('id')">
                  <div class="lg:col-span-3">
                    <label for="setting_id">ID</label>
                    <input type="text" id="setting_id" x-model="$store.settings.item.id">
                  </div>
                </template>

                <div class="lg:col-span-3">
                  <label for="setting_type">Type</label>
                  <select id="setting_type" x-model="$store.settings.item.type">
                    <option value="text">text</option>
                    <option value="textarea">textarea</option>
                    <option value="number">number</option>
                    <option value="radio">radio</option>
                    <option value="range">range</option>
                    <option value="select">select</option>
                    <option value="article">article</option>
                    <option value="blog">blog</option>
                    <option value="collection">collection</option>
                    <option value="color">color</option>
                    <option value="font_picker">font picker</option>
                    <option value="html">html</option>
                    <option value="image_picker">image picker</option>
                    <option value="link_link">link link</option>
                    <option value="liquid">liquid</option>
                    <option value="richtext">richtext</option>
                    <option value="url">url</option>
                    <option value="video_url">video url</option>
                    <option value="header">header</option>
                  </select>
                </div>

                <template x-if="shouldShow('label')">
                  <div class="lg:col-span-3">
                    <label for="setting_label">Label</label>
                    <input type="text" id="setting_label" x-model="$store.settings.item.label">
                  </div>
                </template>

                <template x-if="shouldShow('placeholder')">
                  <div class="lg:col-span-3">
                    <label for="setting_placeholder">Placeholder</label>
                    <input type="text" id="setting_placeholder" x-model="$store.settings.item.placeholder">
                  </div>
                </template>

                <template x-if="shouldShow('content')">
                  <div class="lg:col-span-3">
                    <label for="setting_content">Content</label>
                    <input type="text" id="setting_content" x-model="$store.settings.item.content">
                  </div>
                </template>

                <template x-if="shouldShow('default')">
                  <div class="lg:col-span-6">
                    <label for="setting_default">Default</label>
                    <textarea id="setting_default" rows="4" x-model="$store.settings.item.default">
                    </textarea>

                    <template x-if="$store.settings.item.type === 'html'">
                      <p class="mt-1 text-sm text-gray-500">
                        <span role="img">
                          üí°
                        </span>

                        Remember to wrap your content in HTML tags
                      </p>
                    </template>

                    <template x-if="$store.settings.item.type === 'liquid'">
                      <p class="mt-1 text-sm text-gray-500">
                        <span role="img">
                          üí°
                        </span>

                        Remember to wrap your content in Liquid tags
                      </p>
                    </template>
                  </div>
                </template>

                <template x-if="shouldShow('info')">
                  <div class="lg:col-span-6">
                    <label for="setting_info">Info</label>
                    <textarea id="setting_info" rows="4" x-model="$store.settings.item.info">
                    </textarea>
                  </div>
                </template>

                <template x-if="$store.settings.item.type === 'video_url'">
                  <div class="lg:col-span-6">
                    <p class="text-sm font-medium">
                      Accept
                    </p>

                    <div class="mt-4 space-y-2">
                      <div>
                        <label
                          for="setting_accept_vimeo"
                          class="flex items-center"
                        >
                          <input id="setting_accept_vimeo" type="checkbox" value="vimeo" x-model="$store.settings.item.accept">

                          <span class="ml-1.5 text-sm">
                            Vimeo
                          </span>
                        </label>
                      </div>

                      <div>
                        <label
                          for="setting_accept_youtube"
                          class="flex items-center"
                        >
                          <input id="setting_accept_youtube" type="checkbox" value="youtube" x-model="$store.settings.item.accept">

                          <span class="ml-1.5 text-sm">
                            YouTube
                          </span>
                        </label>
                      </div>
                    </div>
                  </div>
                </template>

                <template x-if="$store.settings.item.type === 'range'">
                  <div class="lg:col-span-6">
                    <p class="text-sm font-medium">
                      Range
                    </p>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="setting_min">Min</label>
                        <input type="number" id="setting_min" x-model="$store.settings.item.min">
                      </div>

                      <div class="lg:col-span-3">
                        <label for="setting_max">Max</label>
                        <input type="number" id="setting_max" x-model="$store.settings.item.max">
                      </div>

                      <div class="lg:col-span-3">
                        <label for="setting_step">Step</label>
                        <input type="number" id="setting_step" x-model="$store.settings.item.step">
                      </div>

                      <div class="lg:col-span-3">
                        <label for="setting_unit">Unit</label>
                        <select id="setting_unit" x-model="$store.settings.item.unit">
                          <option value="px">px</option>
                          <option value="rem">rem</option>
                          <option value="em">em</option>
                          <option value="%">%</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </template>

                <template x-if="['radio', 'select'].includes($store.settings.item.type)">
                  <div class="lg:col-span-6">
                    <p class="text-sm font-medium">
                      Options
                    </p>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="option_label">Label</label>

                        <input
                          type="text"
                          id="option_label"
                          x-model="$store.options.item.label"
                        >
                      </div>

                      <div class="lg:col-span-3">
                        <label for="option_value">Value</label>

                        <input
                          type="text"
                          id="option_value"
                          x-model="$store.options.item.value"
                        >
                      </div>

                      <template x-if="setting.type === 'select'">
                        <div class="lg:col-span-3">
                          <label for="option_group">Group</label>

                          <input
                            type="text"
                            id="option_group"
                            x-model="$store.options.item.group"
                          >
                        </div>
                      </template>
                    </div>

                    <template x-if="$store.options.items.length > 0">
                      <div class="flow-root mt-4">
                        <ul class="flex flex-wrap -m-1">
                          <template x-for="(option, index) in $store.options.items">
                            <li class="p-1">
                              <strong class="inline-flex items-center px-3 py-1 bg-gray-100 border border-gray-200 rounded-full">
                                <span class="text-xs font-medium" x-text="option.label"></span>

                                <button
                                  type="button"
                                  class="w-5 h-5 p-0 rounded-full"
                                  @click="$store.options.remove(index)"
                                >
                                  <span role="img" class="ml-0">
                                    üóë
                                  </span>
                                </button>
                              </strong>
                            </li>
                          </template>
                        </ul>
                      </div>
                    </template>

                    <button
                      type="button"
                      class="mt-4 bg-gray-200"
                      @click="$store.options.add"
                    >
                      Add Option

                      <span role="img">
                        ü§î
                      </span>
                    </button>
                  </div>
                </template>

                <div class="lg:col-span-6">
                  <label for="target">
                    Block
                  </label>

                  <select
                    id="target"
                    x-model="$store.block"
                  >
                    <option>
                      Please Select
                    </option>

                    <template x-for="block in $store.blocks.items">
                      <option
                        :value="block.name"
                        x-text="block.name"
                      ></option>
                    </template>
                  </select>
                </div>

                <div class="lg:col-span-6">
                  <button
                    type="button"
                    class="bg-gray-200"
                    @click="$store.settings.add"
                  >
                    Add Setting

                    <span role="img">
                      ü•≥
                    </span>
                  </button>
                </div>
              </div>
            </fieldset>

            <fieldset class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div>
                <legend class="font-medium">
                  <span
                    role="img"
                    class="mr-1.5"
                  >
                    üüß
                  </span>

                  Blocks
                </legend>

                <p class="mt-1 text-sm max-w-[40ch]">
                  Lorem ipsum dolor sit amet consectetur adipisicing elit. Error tempora ea quo doloremque aperiam ad!
                </p>
              </div>

              <div class="grid grid-cols-1 gap-4 lg:grid-cols-6 lg:col-span-2">
                <div class="lg:col-span-3">
                  <label for="block_name">
                    Name
                  </label>

                  <input
                    type="text"
                    id="block_name"
                    x-model="$store.blocks.item.name"
                  >
                </div>

                <div class="lg:col-span-3">
                  <label for="block_type">
                    Type
                  </label>

                  <input
                    type="text"
                    id="block_type"
                    x-model="$store.blocks.item.type"
                  >
                </div>

                <div class="lg:col-span-3">
                  <label for="block_limit">
                    Limit
                  </label>

                  <input
                    type="number"
                    id="block_limit"
                    x-model="$store.blocks.item.limit"
                  >
                </div>

                <div class="lg:col-span-6">
                  <button
                    type="button"
                    @click="$store.blocks.add"
                    class="bg-gray-200"
                  >
                    Add Block

                    <span role="img">
                      üß±
                    </span>
                  </button>
                </div>
              </div>
            </fieldset>

            <div x-data="{ show: false }">
              <div class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
                <div>
                  <p class="font-medium">
                    <span
                      role="img"
                      class="mr-1.5"
                    >
                      ü¶æ
                    </span>

                    Enhanced Features
                  </p>

                  <p class="mt-1 text-sm max-w-[40ch]">
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptate, cupiditate?
                  </p>
                </div>

                <div class="space-y-8 lg:col-span-2">
                  <fieldset class="p-8 bg-gray-100 border border-gray-200 rounded-lg">
                    <div>
                      <legend class="font-medium">
                        <span
                          role="img"
                          class="mr-1.5"
                        >
                          üåÄ
                        </span>

                        Presets
                      </legend>

                      <p class="mt-1 text-sm max-w-[40ch]">
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptate, cupiditate?
                      </p>
                    </div>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="preset_name">
                          Name
                        </label>

                        <input
                          type="text"
                          id="preset_name"
                          x-model="$store.presets.item.name"
                        >
                      </div>

                      <div class="lg:col-span-6">
                        <template x-if="$store.presets.items.length === 0">
                          <button
                            type="button"
                            class="bg-gray-200"
                            @click="$store.presets.add"
                          >
                            Add Preset

                            <span role="img">
                              üê≥
                            </span>
                          </button>
                        </template>

                        <template x-if="$store.presets.items.length !== 0">
                          <button
                            type="button"
                            class="bg-gray-200"
                            @click="$store.presets.remove"
                          >
                            Remove Preset

                            <span role="img">
                              üëã
                            </span>
                          </button>
                        </template>
                      </div>
                    </div>
                  </fieldset>

                  <fieldset class="p-8 bg-gray-100 border border-gray-200 rounded-lg">
                    <div>
                      <legend class="font-medium">
                        <span
                          role="img"
                          class="mr-1.5"
                        >
                          üåé
                        </span>

                        Locales
                      </legend>

                      <p class="mt-1 text-sm max-w-[40ch]">
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptate, cupiditate?
                      </p>
                    </div>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="translation_lang">
                          Language
                        </label>

                        <input
                          type="text"
                          id="translation_lang"
                          x-model="$store.locales.item.lang"
                        >
                      </div>

                      <div class="lg:col-span-3">
                        <label for="translate_setting">
                          Setting
                        </label>

                        <select
                          id="translate_setting"
                          x-model="$store.locales.item.setting"
                        >
                          <option>Please Select</option>

                          <template x-for="setting in allSettings">
                            <option
                              :value="setting.id"
                              x-text="setting.label"
                            ></option>
                          </template>
                        </select>
                      </div>

                      <div class="lg:col-span-3">
                        <label for="translate_value">
                          Value
                        </label>

                        <input
                          type="text"
                          id="translate_value"
                          x-model="$store.locales.item.value"
                        >
                      </div>

                      <div class="lg:col-span-6">
                        <button
                          type="button"
                          @click="$store.locales.add"
                          class="bg-gray-200"
                        >
                          Add Translation

                          <span role="img">
                            üó£
                          </span>
                        </button>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div class="space-y-8">
                <div>
                  <p class="font-medium">
                    Settings
                  </p>

                  <template x-if="!$store.settings.items || $store.settings.items.length === 0">
                    <p class="mt-1 text-sm text-gray-500">
                      Nothing to see here... Let's add a setting!

                      <span role="img">
                        üí™
                      </span>
                    </p>
                  </template>

                  <ul class="mt-4 space-y-4">
                    <template x-for="(setting, index) in $store.settings.items">
                      <li
                        x-data="{ show: false }"
                        class="p-2 bg-gray-100 border border-gray-200 rounded-lg"
                      >
                        <div class="flex items-center justify-between">
                          <span
                            x-text="setting.label"
                            class="text-sm font-medium"
                          >
                          </span>

                          <div class="flex items-center space-x-1.5">
                            <button
                              type="button"
                              class="px-1.5 py-1 text-xs bg-blue-100 rounded"
                              @click="show = !show"
                            >
                              Manage
                            </button>

                            <button
                              type="button"
                              class="px-1.5 py-1 text-xs bg-red-100 rounded"
                              @click="$store.settings.remove(index)"
                            >
                              Remove
                            </button>
                          </div>
                        </div>

                        <div
                          x-show="show"
                          class="mt-4 space-y-4"
                        >
                          <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                            <label>
                              Move
                            </label>

                            <select @change="$store.settings.move(index, $event.target.value)">
                              <option value="">Please Select</option>
                              <template x-for="block in $store.blocks.items">
                                <option :value="block.name" x-text="block.name"></option>
                              </template>
                            </select>
                          </div>

                          <template x-if="$store.locales.any(setting)">
                            <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                              <p class="text-sm font-medium">
                                Locales
                              </p>

                              <ul class="mt-1.5 space-y-1.5">
                                <template x-for="(value, key) in $store.locales.translations(setting)">
                                  <li class="flex items-center justify-between">
                                    <span
                                      x-text="value[setting.id]"
                                      class="text-xs font-medium"
                                    ></span>

                                    <div class="flex items-center space-x-1.5">
                                      <span
                                        x-text="key"
                                        class="px-1.5 py-1 text-xs font-medium rounded bg-blue-100"
                                      ></span>

                                      <button
                                        type="button"
                                        @click="$store.locales.remove(key, setting)"
                                        class="px-1.5 py-1 text-xs bg-red-100 rounded"
                                      >
                                        Remove
                                      </button>
                                    </div>
                                  </li>
                                </template>
                              </ul>
                            </div>
                          </template>
                        </div>
                      </li>
                    </template>
                  </ul>
                </div>

                <div>
                  <p class="font-medium">
                    Blocks
                  </p>

                  <template x-if="!$store.blocks.items || $store.blocks.items.length === 0">
                    <p class="mt-1 text-sm text-gray-500">
                      Nothing to see here... Let's add some blocks!

                      <span role="img">
                        ü§ñ
                      </span>
                    </p>
                  </template>

                  <ul class="mt-4 space-y-4">
                    <template x-for="(block, index) in $store.blocks.items">
                      <li class="p-2 bg-gray-100 border border-gray-200 rounded-lg">
                        <div class="flex items-center justify-between">
                          <span
                            x-text="block.name"
                            class="text-sm font-medium"
                          >
                          </span>

                          <button
                            type="button"
                            @click="$store.blocks.remove(index)"
                            class="px-1.5 py-1 text-xs bg-red-100 rounded"
                          >
                            Remove
                          </button>
                        </div>

                        <template x-if="block.settings.length > 0">
                          <ul class="mt-4 space-y-4 border-t border-gray-200">
                            <template x-for="(setting, index) in block.settings">
                              <li x-data="{ show: false }">
                                <div class="flex items-center justify-between">
                                  <span
                                    x-text="setting.label"
                                    class="text-sm font-medium"
                                  >
                                  </span>

                                  <div class="flex items-center space-x-1.5">
                                    <button
                                      type="button"
                                      @click="show = !show"
                                      class="px-1.5 py-1 text-xs bg-blue-100 rounded"
                                    >
                                      Manage
                                    </button>

                                    <button
                                      type="button"
                                      @click="$store.settings.remove(index, block.name)"
                                      class="px-1.5 py-1 text-xs bg-red-100 rounded"
                                    >
                                      Remove
                                    </button>
                                  </div>
                                </div>

                                <div
                                  x-show="show"
                                  class="mt-4 space-y-4"
                                >
                                  <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                                    <label>
                                      Move
                                    </label>

                                    <select @change="$store.settings.move(index, $event.target.value, block.name)">
                                      <option>Please Select</option>
                                      <option value="settings">Settings</option>

                                      <template x-for="item in $store.blocks.items">
                                        <template x-if="item.name !== block.name">
                                          <option
                                            :value="item.name"
                                            x-text="item.name"
                                          >
                                          </option>
                                        </template>
                                      </template>
                                    </select>
                                  </div>

                                  <template x-if="$store.locales.any(setting)">
                                    <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                                      <p class="text-sm font-medium">
                                        Locales
                                      </p>

                                      <ul class="mt-1.5 space-y-1.5">
                                        <template x-for="(translation, lang) in $store.locales.translations(setting)">
                                          <li class="flex items-center justify-between">
                                            <span
                                              x-text="translation[setting.id]"
                                              class="text-xs font-medium"
                                            ></span>

                                            <div class="flex items-center space-x-1.5">
                                              <span
                                                x-text="lang"
                                                class="px-1.5 py-1 text-xs font-medium rounded bg-blue-100"
                                              ></span>

                                              <button
                                                type="button"
                                                @click="removeTranslation(lang, setting.id)"
                                                class="px-1.5 py-1 text-xs bg-red-100 rounded"
                                              >
                                                Remove
                                              </button>
                                            </div>
                                          </li>
                                        </template>
                                      </ul>
                                    </div>
                                  </template>
                                </div>
                              </li>
                            </template>
                          </ul>
                        </template>
                      </li>
                    </template>
                  </ul>
                </div>
              </div>

              <div class="relative lg:col-span-2">
                <textarea
                  rows="15"
                  id="textarea"
                  x-text="JSON.stringify(data, null, 2)"
                  class="block font-mono bg-white border border-gray-200 rounded-lg"
                ></textarea>

                <button
                  type="button"
                  @click="copyToClipboard"
                  class="absolute bg-gray-200 bottom-3 right-3"
                >
                  Copy to Clipboard

                  <span role="img">
                    üìã
                  </span>
                </button>
              </div>
            </div>
          </div>

          <div class="flex justify-end mt-8">
            <button
              type="submit"
              class="text-white bg-green-600"
            >
              Update Section

              <span role="img">
                üëå
              </span>
            </button>
          </div>
        </form>
      </section>
    </div>
  </main>

  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('schema', () => ({
        init() {
          this.updateSection()
        },

        data: '',

        updateSection() {
          const { name, tag, max_blocks, class: className, } = Alpine.store('details')
          const { items: settings } = Alpine.store('settings')
          const { items: blocks } = Alpine.store('blocks')
          const { items: presets } = Alpine.store('presets')
          const { items: locales } = Alpine.store('locales')

          let schemaData = {
            name,
            tag,
            max_blocks,
            class: className,
            settings,
            blocks,
            presets,
            locales
          }

          schemaData = _.omitBy(schemaData, _.isEmpty)

          this.data = schemaData
        },

        allSettings() {
          const { items: settings } = Alpine.store('settings')
          const { items: blocks } = Alpine.store('blocks')
          const blockSettings = _.flatMap(blocks, (block) => block.settings)

          return [...settings, ...blockSettings]
        },

        copyToClipboard() {
          let textarea = document.getElementById('textarea')

          textarea.select()
          document.execCommand('copy')
        },

        shouldShow(input) {
          const { item: setting } = Alpine.store('settings')
          const { type } = setting
          let base = ['id', 'label', 'info']
          let show = []

          switch (type) {
            case 'text':
              show = [...base, 'default', 'placeholder']
              break
            case 'textarea':
              show = [...base, 'default', 'placeholder']
              break
            case 'number':
              show = [...base, 'default', 'placeholder']
              break
            case 'range':
              show = [...base, 'default', 'min', 'max', 'step', 'unit']
              break
            case 'select':
              show = [...base, 'default', 'options']
              break
            case 'color':
              show = [...base, 'default']
              break
            case 'font_picker':
              show = [...base, 'default']
              break
            case 'html':
              show = [...base, 'default']
              break
            case 'liquid':
              show = [...base, 'default']
              break
            case 'richtext':
              show = [...base, 'default']
              break
            case 'video_url':
              show = [...base, 'placeholder', 'accept']
              break
            case 'header':
              show = ['content']
              break
            default:
              show = base
          }

          return show.includes(input)
        }
      }))
    })
  </script>

  <script>
    // Details

    document.addEventListener('alpine:init', () => {
      Alpine.store('details', {
        max_blocks: '',
        tag: 'section',
        name: 'Shopify Section',
        class: 'shopify-section'
      })
    })
  </script>

  <script>
    // Settings

    const DEFAULT_SETTING = {
      id: 'message',
      type: 'text',
      label: 'Message',
      default: '',
      placeholder: '',
      info: '',
      min: '',
      max: '',
      step: '',
      unit: '',
      options: [],
      accept: [],
    }

    document.addEventListener('alpine:init', () => {
      Alpine.store('settings', {
        items: [],
        item: { ...DEFAULT_SETTING },

        add() {
          const options = Alpine.store('options').items
          const blocks = Alpine.store('blocks').items
          const selectedBlock = Alpine.store('block')
          const setting = self.item
          const newSetting = options.length > 0 && { ...setting, options: [...options] } || { ...setting }

          if (selectedBlock) {
            const block = _.find(blocks, { name: selectedBlock })
            const { settings: blockSettings } = block
            const newBlockSettings = blockSettings.length > 0 && [...blockSettings, setting] || [setting]

            block.settings = newBlockSettings

            Alpine.store('block', '')
          } else {
            self.items = [...self.items, newSetting]
          }

          self.item = { ...DEFAULT_SETTING }
        },

        remove(index, block) {
          const blocks = Alpine.store('blocks').items

          if (block) {
            const currentBlock = _.find(blocks, { 'name': block })
            const newBlockSettings = _.filter(currentBlock.settings, (item, itemIndex) => itemIndex !== index)

            currentBlock.settings = newBlockSettings
          } else {
            const newSettings = _.filter(self.items, (item, itemIndex) => itemIndex !== index)
            self.items = newSettings
          }
        },

        move(index, name, block) {
          const blocks = Alpine.store('blocks').items
          const currentBlock = _.find(blocks, { name: block })
          const isSettings = name === 'settings'

          if (isSettings) {
            const currentSetting = currentBlock.settings[index]

            self.items = [...self.items, currentSetting]
            currentBlock.settings = _.filter(currentBlock.settings, (item, itemIndex) => itemIndex !== index)
          } else {
            const currentSetting = self.items[index]

            currentBlock.settings = [...currentBlock.settings, currentSetting]
            self.items = _.filter(self.items, (item, itemIndex) => itemIndex !== index)
          }
        },
      })

      const self = Alpine.store('settings')
    })
  </script>

  <script>
    // Options

    const DEFAULT_OPTION = {
      value: '',
      label: '',
      group: '',
    }

    document.addEventListener('alpine:init', () => {
      Alpine.store('options', {
        items: [],
        item: { ...DEFAULT_OPTION },

        add() {
          const newItems = self.items && [...self.items, self.item] || [self.item]

          self.items = newItems
          self.item = { ...DEFAULT_OPTION }
        },

        remove(index) {
          const newItems = _.filter(self.items, (item, itemIndex) => itemIndex !== index)

          self.items = newItems
        },
      })

      const self = Alpine.store('options')
    })
  </script>

  <script>
    const DEFAULT_BLOCK = {
      name: '',
      type: '',
      limit: '',
      settings: [],
    }

    document.addEventListener('alpine:init', () => {
      Alpine.store('blocks', {
        items: [],
        item: { ...DEFAULT_BLOCK },

        add() {
          const { type } = self.item
          const types = _.map(self.items, 'type')

          if (types.includes(type)) return

          const block = self.item
          const newItems = self.items && [...self.items, block] || [block]

          self.items = newItems
          self.item = { ...DEFAULT_BLOCK }
        },

        remove(index) {
          const newItems = _.find(self.items, [], [index])

          self.items = newItems
        },
      })

      const self = Alpine.store('blocks')
    })
  </script>

  <script>
    // Block

    document.addEventListener('alpine:init', () => {
      Alpine.store('block', '')
    })
  </script>

  <script>
    // Presets

    document.addEventListener('alpine:init', () => {
      Alpine.store('presets', {
        items: [],
        item: {
          name: ''
        },

        add() {
          const newItems = self.items && [...self.items, self.item] || [self.item]

          self.items = newItems
        },

        remove() {
          self.items = []
        }
      })

      const self = Alpine.store('presets')
    })
  </script>

  <script>
    // Locales

    // This is by far the most complicated store in the whole project
    // don't be put off, keep pushing through üí™

    const DEFAULT_TRANSLATION = {
      lang: '',
      value: '',
      setting: '',
    }

    document.addEventListener('alpine:init', () => {
      Alpine.store('locales', {
        items: [],
        item: { ...DEFAULT_TRANSLATION },

        add() {
          const { lang, setting, value } = self.item
          const locale = self.items[lang] || {}
          const newLocale = { ...locale, [setting]: value }

          self.items = { ...self.items, [lang]: newLocale }
          self.item = { ...DEFAULT_TRANSLATION }
        },

        remove(key, setting) {
          const { id } = setting
          const locale = self.items[key]
          const newLocale = _.pickBy(locale, (value, key) => key !== id)

          let newItems = { ...self.items, [key]: newLocale }

          newItems = _.keys(newLocale).length === 0 && _.omit(self.items, key)

          self.items = newItems
        },

        translations(setting) {
          const { id } = setting
          const keys = _.keys(self.items)
          const translations = _.pick(self.items, [...keys, id])

          return translations
        },

        any(setting) {
          const { id } = setting
          const translations = self.translations(id)

          return _.keys(translations).length > 0
        }
      })

      const self = Alpine.store('locales')
    })
  </script>
</body>
</html>
