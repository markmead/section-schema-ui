<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Section Schema UI | Shopify</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="build.css">
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="relative antialiased">
  <main role="main">
    <div class="max-w-screen-xl px-4 py-12 mx-auto">
      <section>
        <div class="max-w-prose">
          <h1 class="text-3xl font-bold">
            Section Schema UI for Shopify
          </h1>

          <p class="mt-4">
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Eius omnis exercitationem minus obcaecati suscipit culpa earum ea consequuntur atque dolores, dolorem esse aspernatur, tenetur nesciunt vel optio quibusdam explicabo debitis!
          </p>
        </div>
      </section>

      <section
        x-data="schema"
        class="p-8 mt-8 border border-gray-100 bg-gray-50 rounded-3xl"
      >
        <form
          @submit.prevent="createSection"
          class="flow-root"
        >
          <div class="-my-8 divide-y divide-gray-100">
            <fieldset class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div>
                <legend class="font-medium">
                  <span
                    role="img"
                    class="mr-1.5"
                  >
                    üìá
                  </span>

                  Details
                </legend>

                <p class="mt-1 text-sm max-w-[40ch]">
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Odio laudantium eaque quibusdam, obcaecati sint sunt.
                </p>
              </div>

              <div class="grid grid-cols-1 gap-4 lg:grid-cols-6 lg:col-span-2">
                <div class="lg:col-span-3">
                  <label for="details_name">Name</label>
                  <input type="text" id="details_name" x-model="$store.details.name" @input="createSection">
                </div>

                <div class="lg:col-span-3">
                  <label for="details_class">Class</label>
                  <input type="text" id="details_class" x-model="$store.details.class" @input="createSection">
                </div>

                <div class="lg:col-span-2">
                  <label for="details_tag">Tag</label>
                  <select id="details_tag" x-model="$store.details.tag" @change="createSection">
                    <option value="div">div</option>
                    <option value="section">section</option>
                    <option value="header">header</option>
                    <option value="footer">footer</option>
                    <option value="article">article</option>
                    <option value="aside">aside</option>
                  </select>
                </div>

                <div class="lg:col-span-2">
                  <label for="details_max_blocks">Max Blocks</label>
                  <input type="number" id="details_max_blocks" x-model="$store.details.max_blocks" @input="createSection">
                </div>
              </div>
            </fieldset>

            <fieldset class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div>
                <legend class="font-medium">
                  <span
                    role="img"
                    class="mr-1.5"
                  >
                    ‚öôÔ∏è
                  </span>

                  Settings
                </legend>

                <p class="max-w-[40ch] mt-1 text-sm">
                  Lorem, ipsum dolor sit amet consectetur adipisicing elit. Non, quod beatae voluptates possimus recusandae dolor!
                </p>
              </div>

              <div class="grid grid-cols-1 gap-4 lg:grid-cols-6 lg:col-span-2">
                <template x-if="shouldShow('id')">
                  <div class="lg:col-span-3">
                    <label for="setting_id">ID</label>
                    <input type="text" id="setting_id" x-model="setting.id">
                  </div>
                </template>

                <div class="lg:col-span-3">
                  <label for="setting_type">Type</label>
                  <select id="setting_type" x-model="setting.type">
                    <option value="text">text</option>
                    <option value="textarea">textarea</option>
                    <option value="number">number</option>
                    <option value="radio">radio</option>
                    <option value="range">range</option>
                    <option value="select">select</option>
                    <option value="article">article</option>
                    <option value="blog">blog</option>
                    <option value="collection">collection</option>
                    <option value="color">color</option>
                    <option value="font_picker">font picker</option>
                    <option value="html">html</option>
                    <option value="image_picker">image picker</option>
                    <option value="link_link">link link</option>
                    <option value="liquid">liquid</option>
                    <option value="richtext">richtext</option>
                    <option value="url">url</option>
                    <option value="video_url">video url</option>
                    <option value="header">header</option>
                  </select>
                </div>

                <template x-if="shouldShow('label')">
                  <div class="lg:col-span-3">
                    <label for="setting_label">Label</label>
                    <input type="text" id="setting_label" x-model="setting.label">
                  </div>
                </template>

                <template x-if="shouldShow('placeholder')">
                  <div class="lg:col-span-3">
                    <label for="setting_placeholder">Placeholder</label>
                    <input type="text" id="setting_placeholder" x-model="setting.placeholder">
                  </div>
                </template>

                <template x-if="shouldShow('content')">
                  <div class="lg:col-span-3">
                    <label for="setting_content">Content</label>
                    <input type="text" id="setting_content" x-model="setting.content">
                  </div>
                </template>

                <template x-if="shouldShow('default')">
                  <div class="lg:col-span-6">
                    <label for="setting_default">Default</label>
                    <textarea id="setting_default" rows="4" x-model="setting.default">
                    </textarea>

                    <template x-if="setting.type === 'html'">
                      <p class="mt-1 text-sm text-gray-500">
                        <span role="img">
                          üí°
                        </span>

                        Remember to wrap your content in HTML tags
                      </p>
                    </template>

                    <template x-if="setting.type === 'liquid'">
                      <p class="mt-1 text-sm text-gray-500">
                        <span role="img">
                          üí°
                        </span>

                        Remember to wrap your content in Liquid tags
                      </p>
                    </template>
                  </div>
                </template>

                <template x-if="shouldShow('info')">
                  <div class="lg:col-span-6">
                    <label for="setting_info">Info</label>
                    <textarea id="setting_info" rows="4" x-model="setting.info">
                    </textarea>
                  </div>
                </template>

                <template x-if="setting.type === 'video_url'">
                  <div class="lg:col-span-6">
                    <p class="text-sm font-medium">
                      Accept
                    </p>

                    <div class="mt-4 space-y-2">
                      <div>
                        <label
                          for="setting_accept_vimeo"
                          class="flex items-center"
                        >
                          <input id="setting_accept_vimeo" type="checkbox" value="vimeo" x-model="setting.accept">

                          <span class="ml-1.5 text-sm">
                            Vimeo
                          </span>
                        </label>
                      </div>

                      <div>
                        <label
                          for="setting_accept_youtube"
                          class="flex items-center"
                        >
                          <input id="setting_accept_youtube" type="checkbox" value="youtube" x-model="setting.accept">

                          <span class="ml-1.5 text-sm">
                            YouTube
                          </span>
                        </label>
                      </div>
                    </div>
                  </div>
                </template>

                <template x-if="setting.type === 'range'">
                  <div class="lg:col-span-6">
                    <p class="text-sm font-medium">
                      Range
                    </p>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="setting_min">Min</label>
                        <input type="number" id="setting_min" x-model="setting.min">
                      </div>

                      <div class="lg:col-span-3">
                        <label for="setting_max">Max</label>
                        <input type="number" id="setting_max" x-model="setting.max">
                      </div>

                      <div class="lg:col-span-3">
                        <label for="setting_step">Step</label>
                        <input type="number" id="setting_step" x-model="setting.step">
                      </div>

                      <div class="lg:col-span-3">
                        <label for="setting_unit">Unit</label>
                        <select id="setting_unit" x-model="setting.unit">
                          <option value="px">px</option>
                          <option value="rem">rem</option>
                          <option value="em">em</option>
                          <option value="%">%</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </template>

                <template x-if="['radio', 'select'].includes(setting.type)">
                  <div class="lg:col-span-6">
                    <p class="text-sm font-medium">
                      Options
                    </p>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="option_label">Label</label>

                        <input
                          type="text"
                          id="option_label"
                          x-model="$store.options.item.label"
                        >
                      </div>

                      <div class="lg:col-span-3">
                        <label for="option_value">Value</label>

                        <input
                          type="text"
                          id="option_value"
                          x-model="$store.options.item.value"
                        >
                      </div>

                      <template x-if="setting.type === 'select'">
                        <div class="lg:col-span-3">
                          <label for="option_group">Group</label>

                          <input
                            type="text"
                            id="option_group"
                            x-model="$store.options.item.group"
                          >
                        </div>
                      </template>
                    </div>

                    <template x-if="$store.options.items.length > 0">
                      <div class="flow-root mt-4">
                        <ul class="flex flex-wrap -m-1">
                          <template x-for="(option, index) in $store.options.items">
                            <li class="p-1">
                              <strong class="inline-flex items-center px-3 py-1 bg-gray-100 border border-gray-200 rounded-full">
                                <span class="text-xs font-medium" x-text="option.label"></span>

                                <button
                                  type="button"
                                  class="w-5 h-5 p-0 rounded-full"
                                  @click="$store.options.remove(index)"
                                >
                                  <span role="img" class="ml-0">
                                    üóë
                                  </span>
                                </button>
                              </strong>
                            </li>
                          </template>
                        </ul>
                      </div>
                    </template>

                    <button
                      type="button"
                      class="mt-4 bg-gray-200"
                      @click="$store.options.add"
                    >
                      Add Option

                      <span role="img">
                        ü§î
                      </span>
                    </button>
                  </div>
                </template>

                <div class="lg:col-span-6">
                  <label for="target">
                    Block
                  </label>

                  <select id="target" x-model="target">
                    <option value="">Please Select</option>
                    <template x-for="block in blocks">
                      <option :value="block.name" x-text="block.name"></option>
                    </template>
                  </select>
                </div>

                <div class="lg:col-span-6">
                  <button
                    type="button"
                    @click="addSetting"
                    class="bg-gray-200"
                  >
                    Add Setting

                    <span role="img">
                      ü•≥
                    </span>
                  </button>
                </div>
              </div>
            </fieldset>

            <fieldset class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div>
                <legend class="font-medium">
                  <span
                    role="img"
                    class="mr-1.5"
                  >
                    üüß
                  </span>

                  Blocks
                </legend>

                <p class="mt-1 text-sm max-w-[40ch]">
                  Lorem ipsum dolor sit amet consectetur adipisicing elit. Error tempora ea quo doloremque aperiam ad!
                </p>
              </div>

              <div class="grid grid-cols-1 gap-4 lg:grid-cols-6 lg:col-span-2">
                <div class="lg:col-span-3">
                  <label for="block_name">Name</label>
                  <input type="text" id="block_name" x-model="block.name">
                </div>

                <div class="lg:col-span-3">
                  <label for="block_type">Type</label>
                  <input type="text" id="block_type" x-model="block.type">
                </div>

                <div class="lg:col-span-3">
                  <label for="block_limit">Limit</label>
                  <input type="number" id="block_limit" x-model="block.limit">
                </div>

                <div class="lg:col-span-6">
                  <button
                    type="button"
                    @click="addBlock"
                    class="bg-gray-200"
                  >
                    Add Block

                    <span role="img">
                      üß±
                    </span>
                  </button>
                </div>
              </div>
            </fieldset>

            <div x-data="{ show: false }">
              <div class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
                <div>
                  <p class="font-medium">
                    <span
                      role="img"
                      class="mr-1.5"
                    >
                      ü¶æ
                    </span>

                    Enhanced Features
                  </p>

                  <p class="mt-1 text-sm max-w-[40ch]">
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptate, cupiditate?
                  </p>
                </div>

                <div class="space-y-8 lg:col-span-2">
                  <fieldset class="p-8 bg-gray-100 border border-gray-200 rounded-lg">
                    <div>
                      <legend class="font-medium">
                        <span
                          role="img"
                          class="mr-1.5"
                        >
                          üåÄ
                        </span>

                        Presets
                      </legend>

                      <p class="mt-1 text-sm max-w-[40ch]">
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptate, cupiditate?
                      </p>
                    </div>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="preset_name">Name</label>
                        <input type="text" id="preset_name" x-model="preset.name">
                      </div>

                      <div class="lg:col-span-6">
                        <template x-if="presets.length === 0">
                          <button
                            type="button"
                            @click="addPreset"
                            class="bg-gray-200"
                          >
                            Add Preset

                            <span role="img">
                              üê≥
                            </span>
                          </button>
                        </template>

                        <template x-if="presets.length > 0">
                          <button
                            type="button"
                            @click="removePreset"
                            class="bg-gray-200"
                          >
                            Remove Preset

                            <span role="img">
                              üëã
                            </span>
                          </button>
                        </template>
                      </div>
                    </div>
                  </fieldset>

                  <fieldset class="p-8 bg-gray-100 border border-gray-200 rounded-lg">
                    <div>
                      <legend class="font-medium">
                        <span
                          role="img"
                          class="mr-1.5"
                        >
                          üåé
                        </span>

                        Locales
                      </legend>

                      <p class="mt-1 text-sm max-w-[40ch]">
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptate, cupiditate?
                      </p>
                    </div>

                    <div class="grid grid-cols-1 gap-4 mt-4 lg:grid-cols-6">
                      <div class="lg:col-span-3">
                        <label for="translation_lang">Language</label>
                        <input type="text" id="translation_lang" x-model="translation.lang">
                      </div>

                      <div class="lg:col-span-3">
                        <label for="translate_setting">Setting</label>
                        <select id="translate_setting" x-model="translation.setting">
                          <option value="">Please Select</option>
                          <template x-for="setting in allSettings">
                            <option :value="setting.id" x-text="setting.label"></option>
                          </template>
                        </select>
                      </div>

                      <div class="lg:col-span-3">
                        <label for="translate_value">Value</label>
                        <input type="text" id="translate_value" x-model="translation.value">
                      </div>

                      <div class="lg:col-span-6">
                        <button
                          type="button"
                          @click="addTranslation"
                          class="bg-gray-200"
                        >
                          Add Translation

                          <span role="img">
                            üó£
                          </span>
                        </button>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 gap-4 py-8 lg:grid-cols-3">
              <div class="space-y-8">
                <div>
                  <p class="font-medium">
                    Settings
                  </p>

                  <template x-if="settings.length === 0">
                    <p class="mt-1 text-sm text-gray-500">
                      Nothing to see here... Let's add a setting!

                      <span role="img">
                        üí™
                      </span>
                    </p>
                  </template>

                  <ul class="mt-4 space-y-4">
                    <template x-for="(setting, index) in settings">
                      <li
                        x-data="{ show: false }"
                        class="p-2 bg-gray-100 border border-gray-200 rounded-lg"
                      >
                        <div class="flex items-center justify-between">
                          <span
                            x-text="setting.label"
                            class="text-sm font-medium"
                          >
                          </span>

                          <div class="flex items-center space-x-1.5">
                            <button
                              type="button"
                              @click="show = !show"
                              class="px-1.5 py-1 text-xs bg-blue-100 rounded"
                            >
                              Manage
                            </button>

                            <button
                              type="button"
                              @click="removeSetting(index)"
                              class="px-1.5 py-1 text-xs bg-red-100 rounded"
                            >
                              Remove
                            </button>
                          </div>
                        </div>

                        <div
                          x-show="show"
                          class="mt-4 space-y-4"
                        >
                          <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                            <label>
                              Move
                            </label>

                            <select @change="moveSetting(index, 'settings', $event.target.value)">
                              <option value="">Please Select</option>
                              <template x-for="block in blocks">
                                <option :value="block.name" x-text="block.name"></option>
                              </template>
                            </select>
                          </div>

                          <template x-if="Object.keys(filteredTranslations(setting.id)).length > 0">
                            <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                              <p class="text-sm font-medium">
                                Locales
                              </p>

                              <ul class="mt-1.5 space-y-1.5">
                                <template x-for="(translation, lang) in filteredTranslations(setting.id)">
                                  <li class="flex items-center justify-between">
                                    <span
                                      x-text="translation[setting.id]"
                                      class="text-xs font-medium"
                                    ></span>

                                    <div class="flex items-center space-x-1.5">
                                      <span
                                        x-text="lang"
                                        class="px-1.5 py-1 text-xs font-medium rounded bg-blue-100"
                                      ></span>

                                      <button
                                        type="button"
                                        @click="removeTranslation(lang, setting.id)"
                                        class="px-1.5 py-1 text-xs bg-red-100 rounded"
                                      >
                                        Remove
                                      </button>
                                    </div>
                                  </li>
                                </template>
                              </ul>
                            </div>
                          </template>
                        </div>
                      </li>
                    </template>
                  </ul>
                </div>

                <div>
                  <p class="font-medium">
                    Blocks
                  </p>

                  <template x-if="blocks.length === 0">
                    <p class="mt-1 text-sm text-gray-500">
                      Nothing to see here... Let's add some blocks!

                      <span role="img">
                        ü§ñ
                      </span>
                    </p>
                  </template>

                  <ul class="mt-4 space-y-4">
                    <template x-for="(block, index) in blocks">
                      <li class="p-2 bg-gray-100 border border-gray-200 rounded-lg">
                        <div class="flex items-center justify-between">
                          <span
                            x-text="block.name"
                            class="text-sm font-medium"
                          >
                          </span>

                          <button
                            type="button"
                            @click="removeBlock(index)"
                            class="px-1.5 py-1 text-xs bg-red-100 rounded"
                          >
                            Remove
                          </button>
                        </div>

                        <template x-if="block.settings.length > 0">
                          <ul class="mt-4 space-y-4 border-t border-gray-200">
                            <template x-for="(setting, index) in block.settings">
                              <li x-data="{ show: false }">
                                <div class="flex items-center justify-between">
                                  <span
                                    x-text="setting.label"
                                    class="text-sm font-medium"
                                  >
                                  </span>

                                  <div class="flex items-center space-x-1.5">
                                    <button
                                      type="button"
                                      @click="show = !show"
                                      class="px-1.5 py-1 text-xs bg-blue-100 rounded"
                                    >
                                      Manage
                                    </button>

                                    <button
                                      type="button"
                                      @click="removeSetting(index)"
                                      class="px-1.5 py-1 text-xs bg-red-100 rounded"
                                    >
                                      Remove
                                    </button>
                                  </div>
                                </div>

                                <div
                                  x-show="show"
                                  class="mt-4 space-y-4"
                                >
                                  <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                                    <label>
                                      Move
                                    </label>

                                    <select @change="moveSetting(index, 'settings', $event.target.value)">
                                      <option value="">Please Select</option>
                                      <template x-for="block in blocks">
                                        <option :value="block.name" x-text="block.name"></option>
                                      </template>
                                    </select>
                                  </div>

                                  <template x-if="Object.keys(filteredTranslations(setting.id)).length > 0">
                                    <div class="p-2 border border-gray-200 rounded-lg bg-gray-50">
                                      <p class="text-sm font-medium">
                                        Locales
                                      </p>

                                      <ul class="mt-1.5 space-y-1.5">
                                        <template x-for="(translation, lang) in filteredTranslations(setting.id)">
                                          <li class="flex items-center justify-between">
                                            <span
                                              x-text="translation[setting.id]"
                                              class="text-xs font-medium"
                                            ></span>

                                            <div class="flex items-center space-x-1.5">
                                              <span
                                                x-text="lang"
                                                class="px-1.5 py-1 text-xs font-medium rounded bg-blue-100"
                                              ></span>

                                              <button
                                                type="button"
                                                @click="removeTranslation(lang, setting.id)"
                                                class="px-1.5 py-1 text-xs bg-red-100 rounded"
                                              >
                                                Remove
                                              </button>
                                            </div>
                                          </li>
                                        </template>
                                      </ul>
                                    </div>
                                  </template>
                                </div>
                              </li>
                            </template>
                          </ul>
                        </template>
                      </li>
                    </template>
                  </ul>
                </div>
              </div>

              <div class="relative lg:col-span-2">
                <textarea
                  rows="20"
                  id="textarea"
                  x-text="JSON.stringify(data, null, 2)"
                  class="block font-mono bg-white border border-gray-200 rounded-lg"
                ></textarea>

                <button
                  type="button"
                  @click="copyToClipboard"
                  class="absolute bg-gray-200 bottom-3 right-3"
                >
                  Copy to Clipboard

                  <span role="img">
                    üìã
                  </span>
                </button>
              </div>
            </div>
          </div>

          <div class="flex justify-end mt-8">
            <button
              type="submit"
              class="w-full text-white bg-green-600 lg:w-auto"
            >
              Update Section

              <span role="img">
                üëå
              </span>
            </button>
          </div>
        </form>
      </section>
    </div>
  </main>

  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('schema', () => ({
        init() {
          this.createSection()
        },

        details: {
          name: 'Shopify Section',
          tag: 'div',
          class: 'shopify-section',
          max_blocks: '',
        },

        settings: [],

        setting: {
          type: 'text',
          id: 'message',
          label: 'Message',
          default: '',
          placeholder: '',
          info: '',
          options: [],
          accept: [],
          min: '',
          max: '',
          step: '',
          unit: '',
        },

        option: {
          value: '',
          label: '',
          group: '',
        },

        blocks: [],

        block: {
          name: '',
          type: '',
          limit: '',
          settings: [],
        },

        presets: [],

        preset: {
          name: '',
          settings: [],
          blocks: []
        },

        locales: {},

        translation: {
          lang: 'en',
          setting: 'message',
          value: 'Hello',
        },

        target: '',
        data: '',

        addSetting() {
          let target = this.target
          let setting = Object.assign({}, this.setting)
          let options = Alpine.store('options').items

          setting.options = options || []

          Object.keys(setting).forEach(key => {
            if (setting[key].length === 0) {
              delete setting[key]
            }
          })

          if (target) {
            let block = this.blocks.find(block => block.name === target)

            block.settings.push(setting)
          } else {
            this.settings.push(setting)
          }

          this.setting = {
            type: 'text',
            id: 'message',
            label: 'Message',
            default: '',
            placeholder: '',
            info: '',
            options: [],
            accept: [],
            min: '',
            max: '',
            step: '',
            unit: '',
          }

          this.target = ''
        },

        removeSetting(index, target) {
          let block = this.blocks.find(block => block.name === target)

          if(block) {
            block.settings.splice(index, 1)
          } else {
            this.settings.splice(index, 1);
          }
        },

        moveSetting(index, name, target) {
          if(target === 'settings') {
            let block = this.blocks.find(block => block.name === name)
            let setting = block.settings[index]

            this.settings.push(setting)

            block.settings.splice(index, 1)
          } else {
            let block = this.blocks.find(block => block.name === target)
            let setting = this.settings[index]

            Object.keys(this.locales).forEach(lang => {
              delete this.locales[lang][setting.id]
            })

            block.settings.push(setting)

            this.settings.splice(index, 1)
          }
        },

        addBlock() {
          let types = this.blocks.map(block => block.type);
          let type = this.block.type;

          let block = Object.assign({}, this.block)

          Object.keys(block).forEach(key => {
            block[key] === '' && delete block[key]
          })

          if (types.includes(type)) return

          this.blocks.push(block);

          this.block = {
            name: '',
            type: '',
            limit: '',
            settings: [],
          };
        },

        removeBlock(index) {
          this.blocks.splice(index, 1);
        },

        addPreset() {
          let preset = Object.assign({}, this.preset)

          Object.keys(preset).forEach(key => {
            if (preset[key].length === 0) {
              delete preset[key]
            }
          })

          this.presets.push(this.preset)

          this.preset = {
            name: '',
            settings: [],
            blocks: []
          }
        },

        removePreset() {
          this.presets.pop()
        },

        addTranslation() {
          let translation = Object.assign({}, this.translation)

          if (!this.locales[translation.lang]) {
            this.locales[translation.lang] = {}
          }

          let locale = this.locales[translation.lang]

          locale[translation.setting] = translation.value

          this.translation = {
            name: '',
            setting: '',
            value: '',
          }
        },

        removeTranslation(key, id) {
          let locale = this.locales[key]

          delete locale[id]
        },

        createSection() {
          const { name, class: className, max_blocks, tag } = Alpine.store('details')

          let data = {
            name,
            tag,
            max_blocks,
            class: className,
            settings: this.settings,
            blocks: this.blocks,
            presets: this.presets,
            locales: this.locales,
          }

          Object.keys(data).forEach(key => {
            data[key] === '' && delete data[key]
          })

          this.data = data
        },

        filteredTranslations(id) {
          let settingTranslations = Object.entries(this.locales).reduce((acc, [key, value]) => {
            if (Object.keys(value).includes(id)) {
              acc[key] = value
            }

            return acc
          }, {})

          return settingTranslations
        },

        allSettings() {
          let blockSettings = this.blocks.flatMap((block) => block.settings)

          return [...this.settings, ...blockSettings]
        },

        copyToClipboard() {
          let textarea = document.getElementById('textarea')

          textarea.select()
          document.execCommand('copy')
        },

        shouldShow(input) {
          let type = this.setting.type
          let base = ['id', 'label', 'info']
          let show = []

          switch (type) {
            case 'text':
              show = [...base, 'default', 'placeholder']
              break
            case 'textarea':
              show = [...base, 'default', 'placeholder']
              break
            case 'number':
              show = [...base, 'default', 'placeholder']
              break
            case 'range':
              show = [...base, 'default', 'min', 'max', 'step', 'unit']
              break
            case 'select':
              show = [...base, 'default', 'options']
              break
            case 'color':
              show = [...base, 'default']
              break
            case 'font_picker':
              show = [...base, 'default']
              break
            case 'html':
              show = [...base, 'default']
              break
            case 'liquid':
              show = [...base, 'default']
              break
            case 'richtext':
              show = [...base, 'default']
              break
            case 'video_url':
              show = [...base, 'placeholder', 'accept']
              break
            case 'header':
              show = ['content']
              break
            default:
              show = base
          }

          return show.includes(input)
        }
      }))
    })
  </script>

  <script>
    // Details

    document.addEventListener('alpine:init', () => {
      Alpine.store('details', {
        name: '',
        tag: 'section',
        max_blocks: '',
        class: '',
      })
    })
  </script>

<script>
  // Options

  const DEFAULT_OPTION = {
    value: '',
    label: '',
    group: '',
  }

  document.addEventListener('alpine:init', () => {
    Alpine.store('options', {
      items: [],
      item: {...DEFAULT_OPTION},

      add() {
        const self = Alpine.store('options')
        const newArray = this.items && [...self.items, self.item] || [self.item]

        self.items = newArray
      },

      remove(index) {
        const self = Alpine.store('options')
        const newArray = self.items.filter((item, itemIndex) => itemIndex !== index)

        self.items = newArray
        self.item = {...DEFAULT_OPTION}
      },
    })
  })
</script>
</body>
</html>
